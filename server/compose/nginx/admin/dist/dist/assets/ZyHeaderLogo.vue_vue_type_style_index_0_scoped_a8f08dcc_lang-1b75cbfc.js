import{h,d as c,k as v,u as S,Z as _}from"./index-dca43598.js";import{a as b}from"./server-b9531d4c.js";import{d as K}from"./api.roles-4d1c2b86.js";import{e as T}from"./api.users-e6a2c06b.js";const x=h("db",()=>{function e(r){c.sysSet(r)}function n(){c.sysGet()}function t(){c.sysRemove()}function s(){c.clear()}return{setSysInfo:e,getSysInfo:n,removeSysInfo:t,removeAllInfo:s}}),p=[{meta:{title:"首页"},name:"index",path:"/index"}],O=h("menu",()=>{const e=v(!0),n=v([]),t=v([]),s=x();function r(){const o=c.sysGet("sys");o?(n.value=o.openKeys||[p[0].path],t.value=o.selectedKeys||[p[0].path],e.value=o.isSidebarOpen||e.value):(n.value=[p[0].path],t.value=[p[0].path],s.setSysInfo({isSidebarOpen:e.value,selectedKeys:t.value,openKeys:n.value}))}r();async function i(){e.value=!e.value,await s.setSysInfo({isSidebarOpen:e.value})}function l(o){n.value=[o]}function d(o){t.value=[o]}return{isSidebarOpen:e,openKeys:n,selectedKeys:t,toggleSidebar:i,openKeysSet:l,selectedKeysSet:d}});function P(e,n){if(!e)return e;if(n===void 0)return[...new Set(e)];const s={string:i=>i[n],function:i=>n(i)}[typeof n],r=e.reduce((i,l)=>(i[s(l)]=l,i),{});return Object.values(r)}function w(e,n){const t=e.findIndex(s=>s.path===n);t!==-1&&e.splice(t,1)}const A=h("tabs",()=>{let e=[{meta:{auth:!0,title:"首页"},name:"index",path:"/index"}];const n=S();let t=v([]),s=v(e[0].path);function r(){t.value=[];const u=c.get("tabs")||e;t.value=u,s.value=u[0].path,c.set("tabs",u)}r();function i(){t.value=[],e=[{meta:{auth:!0,title:"首页"},name:"index",path:"/index"}],t.value=e,s.value=e[0].path}function l(a){t.value.push(a),t.value=P(t.value,"path"),c.set("tabs",t.value)}function d(a){const u=t.value.findIndex(f=>f.path===a),I=t.value.findIndex(f=>f.path===s.value);if(w(t.value,a),c.set("tabs",t.value),u>=0){const f=Math.min(u+1,t.value.length-1),g=Math.max(u-1,0),m=t.value[f],y=t.value[g];if(I!==u)return o(s.value);o(m?m.path:y?y.path:t.value[0].path)}else o(t.value[0].path)}function o(a){const u=O();u.selectedKeysSet(a),u.openKeysSet(a),s.value=a,n.push(a)}return{tabsList:t,defaultTabs:e,current:s,resetTabs:i,addTabs:l,currentSet:o,removeTabs:d,initTabs:r}}),R=e=>b.get("/v1/sys/auth/captcha/",e),M=e=>b.post("/v1/sys/auth/login/",e),Z=e=>b.post("/v1/sys/auth/register/",e),j=h("auth",()=>{let e=S();const n=x();let t=A();async function s(){t.resetTabs(),n.removeAllInfo(),await e.replace("/login")}async function r(l){return new Promise((d,o)=>{M(l).then(a=>{c.clear(),c.set("token",a.data.token),T({_id:a.data._id}).then(u=>{c.set("userInfo",{...u.data})}),K({_id:a.data.roleId}).then(u=>{i(u.data.perms),d({...a.data,...u.data}),_.success(`欢迎: ${a.data.nickname}`),e.replace("/")})}).catch(a=>{o(a)})})}async function i(l){c.set("perms",l)}return{setPerm:i,logout:s,login:r}});export{O as a,A as b,x as c,R as d,Z as e,j as u};
