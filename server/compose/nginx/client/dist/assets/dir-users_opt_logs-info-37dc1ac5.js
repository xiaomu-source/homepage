import{_ as Q,Z as y,a as v,b as X,c as N,T as O}from"./util.time-117201b0.js";import{G as z,k as j,r as f,o as b,a as $,c as e,w as a,I as Z,Z as x,H as F,g as c,t as w,d as ee,Y as te,W as B,e as T,y as ae}from"./index-dca43598.js";import{a as C}from"./server-b9531d4c.js";import{_ as oe}from"./ZyToolButton-379302e5.js";import{Z as le}from"./ZySearchForm-eb2c604b.js";import{i as W}from"./util.common-1af15359.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./axios-707ed124.js";const se=s=>C.post("/v1/sys/users_opt_logs/get-list/",s),ne=s=>C.post("/v1/sys/users_opt_logs/create-log/",s),re=s=>C.post("/v1/sys/users_opt_logs/update-log/",s),ue=s=>C.post("/v1/sys/users_opt_logs/delete-log/",s),ie=s=>C.post("/v1/sys/users_opt_logs/deleteAll/",s),de=s=>C.post("/v1/sys/users_opt_logs/export/",s,null,"blob"),pe=s=>C.post("/v1/sys/users_opt_logs/downloadTemplate/",s,null,"blob"),ce={class:"zy-get"},me={__name:"get-users_opt_logs-info",props:{updateData:{type:Object,default:()=>{}}},emits:["close"],setup(s,{emit:I}){const k=s,t={style:{width:"100px"}},u={span:14},n=z({form:{}}),P=j(),q=j(!k.updateData);q.value||(n.form=k.updateData||{});const A=async()=>{try{const h=await P.value.validateFields();q.value||delete n.form.password,(q.value?ne:re)(Z(n.form)).then(m=>{x.success("操作成功"),I("close",!0)})}catch(h){console.log("Failed:",h)}},R=()=>{F("还没保存数据，确认退出?").then(h=>{h&&I("close")})};return(h,r)=>{const m=f("a-input"),g=f("a-form-item"),S=f("a-form");return b(),$("section",ce,[e(S,{model:n.form,class:"zy-form","label-col":t,ref_key:"formRef",ref:P,"wrapper-col":u},{default:a(()=>[e(g,{label:"操作人",name:"operator",rules:[{required:!0,message:"请输入操作人!"}]},{default:a(()=>[e(m,{value:n.form.operator,"onUpdate:value":r[0]||(r[0]=i=>n.form.operator=i),allowClear:"",placeholder:"请输入操作人"},null,8,["value"])]),_:1}),e(g,{label:"操作模块",name:"module",rules:[{required:!0,message:"请输入操作模块!"}]},{default:a(()=>[e(m,{value:n.form.module,"onUpdate:value":r[1]||(r[1]=i=>n.form.module=i),allowClear:"",placeholder:"请输入操作模块"},null,8,["value"])]),_:1}),e(g,{label:"操作平台",name:"platform",rules:[{required:!0,message:"请输入操作平台!"}]},{default:a(()=>[e(m,{value:n.form.platform,"onUpdate:value":r[2]||(r[2]=i=>n.form.platform=i),allowClear:"",placeholder:"请输入操作平台"},null,8,["value"])]),_:1}),e(g,{label:"设备IP",name:"operatorIP",rules:[{required:!0,message:"请输入设备IP!"}]},{default:a(()=>[e(m,{value:n.form.operatorIP,"onUpdate:value":r[3]||(r[3]=i=>n.form.operatorIP=i),allowClear:"",placeholder:"请输入设备IP"},null,8,["value"])]),_:1}),e(g,{label:"设备位置",name:"address",rules:[{required:!0,message:"请输入设备位置!"}]},{default:a(()=>[e(m,{value:n.form.address,"onUpdate:value":r[4]||(r[4]=i=>n.form.address=i),allowClear:"",placeholder:"请输入设备位置"},null,8,["value"])]),_:1}),e(g,{label:"操作内容",name:"content"},{default:a(()=>[e(m,{value:n.form.content,"onUpdate:value":r[5]||(r[5]=i=>n.form.content=i),allowClear:"",placeholder:"请输入操作内容"},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(Q,{onSave:A,onClose:R})])}}},fe={class:"zy-view"},_e={__name:"view-users_opt_logs-info",props:{viewData:{type:Object,default:()=>{}}},emits:["close"],setup(s,{emit:I}){return(k,t)=>(b(),$("section",fe,[e(v,null,{default:a(()=>[e(y,{label:"操作人"},{default:a(()=>[c(w(s.viewData.operator),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"操作模块"},{default:a(()=>[c(w(s.viewData.module),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"操作平台"},{default:a(()=>[c(w(s.viewData.platform),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"设备IP"},{default:a(()=>[c(w(s.viewData.operatorIP),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"设备位置"},{default:a(()=>[c(w(s.viewData.address),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"操作内容"},{default:a(()=>[c(w(s.viewData.content),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"createdAt"},{default:a(()=>[c(w(s.viewData.createdAt),1)]),_:1})]),_:1}),e(v,null,{default:a(()=>[e(y,{label:"updatedAt"},{default:a(()=>[c(w(s.viewData.updatedAt),1)]),_:1})]),_:1})]))}},Ie={__name:"dir-users_opt_logs-info",setup(s){const I=[{title:"操作时间",dataIndex:"createdAt",sorter:(o,l)=>o.createdAt-l.createdAt,key:"createdAt",align:"center"},{title:"操作人",dataIndex:"operator",key:"operator",align:"center"},{title:"操作模块",dataIndex:"module",key:"module",align:"center"},{title:"操作平台",dataIndex:"platform",key:"platform",align:"center"},{title:"设备IP",dataIndex:"operatorIP",key:"operatorIP",align:"center"},{title:"设备位置",dataIndex:"address",key:"address",align:"center"},{title:"操作内容",dataIndex:"content",key:"content",align:"center"},{title:"操作",width:225,key:"action",align:"center",fixed:"right"}],k={authorization:ee.get("token")},t=z({show:{add:!1,edit:!1,view:!1},editTitle:"编辑",activeComponent:null,updateData:{},resetData:{},viewData:{},selectedRowKeys:[],query:{params:{},pagination:{current:1,pageSize:11,total:0,hideOnSinglePage:!0},sort:{columnKey:"createdAt",order:"descend"}},dataList:[],loading:{spinning:!1,tip:"加载中"}}),u=(o=1)=>{t.query.pagination.current=o,A()},n=()=>{u()},P=({current:o,pageSize:l})=>{t.query.pagination=z({current:o,pageSize:l}),A()},q=({columnKey:o,order:l})=>{t.query.sort=z({current:o,order:l}),A()},A=()=>{t.loading.spinning=!0;let o=Z(t.query);se(o).then(l=>{t.loading.spinning=!1;let p=l.data.result;for(const _ of p)_.createdAt=O.formatTime(_.createdAt),_.updatedAt=O.formatTime(_.updatedAt);t.dataList=p,t.query.pagination.total=l.data.total,t.query.pagination.current=l.data.current,t.query.pagination.pageSize=l.data.pageSize}).catch(l=>{t.loading.spinning=!1,console.log(l)})},R=o=>{t.selectedRowKeys=o},h=(o,l,p)=>{W(o)||P(o),W(p)||q(p)},r=o=>{t.show.view=!0,t.viewData=o},m=o=>{t.show.edit=!0,o&&o._id?t.editTitle="修改操作日志":t.editTitle="添加操作日志",t.updateData=o},g=()=>{t.loading.spinning=!0;let o=Z(t.query);de(o).then(l=>{t.loading.spinning=!1}).catch(l=>{t.loading.spinning=!1,console.log(l)})},S=({file:o})=>{o.status==="error"&&x.error(o.response.message||"导入失败"),o.status==="done"&&(x.success(o.response.message||"上传成功"),u())},i=()=>{pe().then(o=>{t.loading.spinning=!1}).catch(o=>{t.loading.spinning=!1,console.log(o)})},G=()=>{F("确认删除数据?").then(o=>{o&&ie({ids:t.selectedRowKeys||[]}).then(l=>{x.success("删除成功"),u()})})},Y=o=>{F("确认删除该条数据?").then(l=>{l&&ue(o).then(p=>{x.success("删除成功"),u()})})},U=o=>{t.show.reset=!1,t.show.view=!1,t.show.edit=!1,o&&u()};return u(),(o,l)=>{const p=f("a-input"),_=f("a-form-item"),E=f("IconFont"),V=f("a-button"),H=f("a-upload"),M=f("a-image"),J=f("a-table"),K=te("permission");return b(),$("section",null,[e(le,{formValue:t.query.params,onSubmit:u,onReset:n},{default:a(()=>[e(_,{name:"operator"},{default:a(()=>[e(p,{value:t.query.params.operator,"onUpdate:value":l[0]||(l[0]=d=>t.query.params.operator=d),allowClear:"",placeholder:"请输入操作人",onPressEnter:u,autocomplete:"off"},null,8,["value"])]),_:1}),e(_,{name:"module"},{default:a(()=>[e(p,{value:t.query.params.module,"onUpdate:value":l[1]||(l[1]=d=>t.query.params.module=d),allowClear:"",placeholder:"请输入操作模块",onPressEnter:u,autocomplete:"off"},null,8,["value"])]),_:1}),e(_,{name:"platform"},{default:a(()=>[e(p,{value:t.query.params.platform,"onUpdate:value":l[2]||(l[2]=d=>t.query.params.platform=d),allowClear:"",placeholder:"请输入操作平台",onPressEnter:u,autocomplete:"off"},null,8,["value"])]),_:1}),e(_,{name:"operatorIP"},{default:a(()=>[e(p,{value:t.query.params.operatorIP,"onUpdate:value":l[3]||(l[3]=d=>t.query.params.operatorIP=d),allowClear:"",placeholder:"请输入设备IP",onPressEnter:u,autocomplete:"off"},null,8,["value"])]),_:1})]),_:1},8,["formValue"]),e(X,{onAdd:m,onDelete:G,addAuth:"sys:users_opt_logs:create",deleteText:"批量删除",deleteAuth:"sys:users_opt_logs:deleteAll"},{default:a(()=>[B((b(),T(V,{type:"primary",size:"small",onClick:g},{icon:a(()=>[e(E,{type:"icon-daochu1"})]),default:a(()=>[c(" 导出 ")]),_:1})),[[K,"sys:users_opt_logs:export"]]),B((b(),T(H,{headers:k,onChange:S,showUploadList:!1,action:"/v1/sys/users_opt_logs/import/"},{default:a(()=>[e(V,{type:"primary",size:"small"},{icon:a(()=>[e(E,{type:"icon-daoru1"})]),default:a(()=>[c(" 导入 ")]),_:1})]),_:1})),[[K,"sys:users_opt_logs:import"]]),e(V,{type:"primary",size:"small",onClick:i},{icon:a(()=>[e(E,{type:"icon-down-arrow"})]),default:a(()=>[c(" 导入模板下载 ")]),_:1})]),_:1}),e(J,{"row-selection":{selectedRowKeys:t.selectedRowKeys,onChange:R},bordered:"",resizable:!0,loading:t.loading,columns:I,"row-key":d=>d._id,pagination:t.query.pagination,onChange:h,"row-class-name":(d,D)=>D%2===1?"table-striped":null,"data-source":t.dataList},{bodyCell:a(({column:d,record:D})=>[d.key==="avatar"?(b(),T(M,{key:0,width:40,src:D.avatar},null,8,["src"])):d.key==="action"?(b(),T(oe,{key:1,viewAuth:"sys:users_opt_logs:list",editAuth:"sys:users_opt_logs:update",deleteAuth:"sys:users_opt_logs:delete",onView:L=>r(D),onEdit:L=>m(D),onDelete:L=>Y(D)},null,8,["onView","onEdit","onDelete"])):ae("",!0)]),_:1},8,["row-selection","loading","row-key","pagination","row-class-name","data-source"]),e(N,{minWidth:650,show:t.show.edit,title:t.editTitle,key:"GetUsers_opt_logsInfo",onClose:U},{default:a(()=>[e(me,{updateData:t.updateData,onClose:U},null,8,["updateData"])]),_:1},8,["show","title"]),e(N,{minWidth:650,show:t.show.view,title:"查看操作日志",key:"ViewUsers_opt_logsInfo",onClose:U},{default:a(()=>[e(_e,{viewData:t.viewData,onClose:U},null,8,["viewData"])]),_:1},8,["show"])])}}};export{Ie as default};
