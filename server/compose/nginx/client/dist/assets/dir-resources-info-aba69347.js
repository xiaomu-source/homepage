import{_ as j,Z as v,a as y,c as R,T as F,b as G}from"./util.time-c8035fa6.js";import{G as x,k as V,r as g,o as c,a as _,c as e,w as l,I as L,Z as q,H as M,g as p,t as f,Y as K,F as Z,W as B,e as T,y as P}from"./index-c61e8b46.js";import{a as U}from"./server-f9881783.js";import{_ as Y}from"./ZyUpload-b5e4a0a9.js";import{_ as H}from"./ZyToolButton-b4cdd6fc.js";import{Z as J}from"./ZySearchForm-94745029.js";import{i as E}from"./util.common-47579a9b.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./axios-707ed124.js";const Q=s=>U.post("/v1/sys/resources/get-list/",s),X=s=>U.post("/v1/sys/resources/create-resource/",s),ee=s=>U.post("/v1/sys/resources/update-resource/",s),te=s=>U.post("/v1/sys/resources/delete-resource/",s),ae={class:"zy-get"},le={__name:"get-resources-info",props:{updateData:{type:Object,default:()=>{}}},emits:["close"],setup(s,{emit:b}){const a=s,h={style:{width:"100px"}},z={span:14},r=x({form:{}}),D=V(),k=V(!a.updateData);k.value||(r.form=a.updateData||{});function I(n){if(n===0)return"0 Bytes";const t=["Bytes","KB","MB","GB","TB"],o=Math.floor(Math.log(n)/Math.log(1024));return`${(n/Math.pow(1024,o)).toFixed(2)} ${t[o]}`}const A=n=>{r.form.deletePath=n.response.data.deleteUrl,r.form.downloadPath=n.response.data.downloadUrl,r.form.previewPath=n.response.data.previewUrl,r.form.srcName=n.response.data.filename,r.form.srcType=n.type,r.form.srcSize=I(n.size)},C=async()=>{try{const n=await D.value.validateFields();k.value||delete r.form.password,(k.value?X:ee)(L(r.form)).then(o=>{q.success("操作成功"),b("close",!0)}).catch(o=>{q.error(o||"操作失败")})}catch(n){console.log("Failed:",n)}},S=()=>{M("还没保存数据，确认退出?").then(n=>{n&&b("close")})};return(n,t)=>{const o=g("a-form-item"),d=g("a-input"),m=g("a-form");return c(),_("section",ae,[e(m,{model:r.form,class:"zy-form","label-col":h,ref_key:"formRef",ref:D,"wrapper-col":z},{default:l(()=>[e(o,{label:"资源名称"},{default:l(()=>[e(Y,{url:r.form.srcName,"onUpdate:url":t[0]||(t[0]=i=>r.form.srcName=i),onUploadChange:A},null,8,["url"])]),_:1}),e(o,{label:"资源名称",name:"srcName",rules:[{required:!0,message:"请输入资源名称!"}]},{default:l(()=>[e(d,{value:r.form.srcName,"onUpdate:value":t[1]||(t[1]=i=>r.form.srcName=i),allowClear:"",placeholder:"请输入资源名称"},null,8,["value"])]),_:1}),e(o,{label:"资源类型",name:"srcType",rules:[{required:!0,message:"请输入资源类型!"}]},{default:l(()=>[e(d,{value:r.form.srcType,"onUpdate:value":t[2]||(t[2]=i=>r.form.srcType=i),allowClear:"",placeholder:"请输入资源类型"},null,8,["value"])]),_:1}),e(o,{label:"资源预览路径",name:"previewPath"},{default:l(()=>[e(d,{value:r.form.previewPath,"onUpdate:value":t[3]||(t[3]=i=>r.form.previewPath=i),allowClear:"",placeholder:"请输入资源预览路径"},null,8,["value"])]),_:1}),e(o,{label:"资源下载路径",name:"downloadPath"},{default:l(()=>[e(d,{value:r.form.downloadPath,"onUpdate:value":t[4]||(t[4]=i=>r.form.downloadPath=i),allowClear:"",placeholder:"请输入资源下载路径"},null,8,["value"])]),_:1}),e(o,{label:"资源删除路径",name:"deletePath"},{default:l(()=>[e(d,{value:r.form.deletePath,"onUpdate:value":t[5]||(t[5]=i=>r.form.deletePath=i),allowClear:"",placeholder:"请输入资源删除路径"},null,8,["value"])]),_:1}),e(o,{label:"备注",name:"remark"},{default:l(()=>[e(d,{value:r.form.remark,"onUpdate:value":t[6]||(t[6]=i=>r.form.remark=i),allowClear:"",placeholder:"请输入备注"},null,8,["value"])]),_:1})]),_:1},8,["model"]),e(j,{onSave:C,onClose:S})])}}},oe={class:"zy-view"},re={__name:"view-resources-info",props:{viewData:{type:Object,default:()=>{}}},emits:["close"],setup(s,{emit:b}){return(a,h)=>(c(),_("section",oe,[e(y,null,{default:l(()=>[e(v,{label:"资源名称"},{default:l(()=>[p(f(s.viewData.srcName),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"资源类型"},{default:l(()=>[p(f(s.viewData.srcType),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"资源预览路径"},{default:l(()=>[p(f(s.viewData.previewPath),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"资源下载路径"},{default:l(()=>[p(f(s.viewData.downloadPath),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"资源删除路径"},{default:l(()=>[p(f(s.viewData.deletePath),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"用户ID"},{default:l(()=>[p(f(s.viewData.userId),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"备注"},{default:l(()=>[p(f(s.viewData.remark),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"状态: 0禁用 1正常"},{default:l(()=>[p(f(s.viewData.status),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"createdAt"},{default:l(()=>[p(f(s.viewData.createdAt),1)]),_:1})]),_:1}),e(y,null,{default:l(()=>[e(v,{label:"updatedAt"},{default:l(()=>[p(f(s.viewData.updatedAt),1)]),_:1})]),_:1})]))}},se={key:0},ne=["href"],ie=["href"],ue=["href"],_e={__name:"dir-resources-info",setup(s){const b=[{title:"资源名称",dataIndex:"srcName",key:"srcName",align:"center"},{title:"资源类型",dataIndex:"srcType",key:"srcType",align:"center"},{title:"资源大小",dataIndex:"srcSize",key:"srcSize",align:"center"},{title:"资源预览",dataIndex:"previewPath",ellipsis:!0,key:"previewPath",align:"center"},{title:"下载地址",dataIndex:"downloadPath",ellipsis:!0,key:"downloadPath",align:"center"},{title:"操作人",dataIndex:"userId",key:"userId",align:"center"},{title:"备注",dataIndex:"remark",key:"remark",align:"center"},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",align:"center"},{title:"操作",width:225,key:"action",align:"center",fixed:"right"}],a=x({show:{add:!1,edit:!1,view:!1},editTitle:"编辑",activeComponent:null,updateData:{},resetData:{},viewData:{},query:{params:{},pagination:{current:1,pageSize:10,total:0,hideOnSinglePage:!0},sort:{columnKey:"createdAt",order:"descend"}},dataList:[],loading:{spinning:!1,tip:"加载中"}}),h=(t=1)=>{a.query.pagination.current=t,k()},z=()=>{h()},r=({current:t,pageSize:o})=>{a.query.pagination=x({current:t,pageSize:o}),k()},D=({columnKey:t,order:o})=>{a.query.sort=x({current:t,order:o}),k()},k=()=>{a.loading.spinning=!0;let t=L(a.query);Q(t).then(o=>{a.loading.spinning=!1;let d=o.data.result;for(const m of d)m.createdAt=F.formatTime(m.createdAt),m.updatedAt=F.formatTime(m.updatedAt);a.dataList=d,a.query.pagination.total=o.data.total,a.query.pagination.current=o.data.current,a.query.pagination.pageSize=o.data.pageSize}).catch(o=>{a.loading.spinning=!1,console.log(o)})},I=(t,o,d)=>{E(t)||r(t),E(d)||D(d)},A=t=>{a.show.view=!0,a.viewData=t},C=t=>{a.show.edit=!0,t&&t._id?a.editTitle="修改资源管理":a.editTitle="添加资源管理",a.updateData=t},S=t=>{M("确认删除该条数据?").then(o=>{o&&te(t).then(d=>{let m=t.deletePath;const i=document.createElement("a");i.href=m,i.target="_blank",i.click(),i.remove(),window.URL.revokeObjectURL(m),q.success("删除成功"),h()})})},n=t=>{a.show.reset=!1,a.show.view=!1,a.show.edit=!1,t&&h()};return h(),(t,o)=>{const d=g("a-input"),m=g("a-form-item"),i=g("a-button"),O=g("a-image"),W=g("a-table"),N=K("copy");return c(),_("section",null,[e(J,{formValue:a.query.params,onSubmit:h,onReset:z},{default:l(()=>[e(m,{name:"srcName"},{default:l(()=>[e(d,{value:a.query.params.srcName,"onUpdate:value":o[0]||(o[0]=w=>a.query.params.srcName=w),allowClear:"",placeholder:"请输入资源名称",onPressEnter:h,autocomplete:"off"},null,8,["value"])]),_:1}),e(m,{name:"srcType"},{default:l(()=>[e(d,{value:a.query.params.srcType,"onUpdate:value":o[1]||(o[1]=w=>a.query.params.srcType=w),allowClear:"",placeholder:"请输入资源类型",onPressEnter:h,autocomplete:"off"},null,8,["value"])]),_:1})]),_:1},8,["formValue"]),e(G,{onAdd:C,addAuth:"sys:resources:create",showDelete:!1}),e(W,{bordered:"",resizable:!0,loading:a.loading,columns:b,"row-key":w=>w._id,pagination:a.query.pagination,onChange:I,"row-class-name":(w,u)=>u%2===1?"table-striped":null,"data-source":a.dataList},{bodyCell:l(({column:w,record:u})=>[w.key==="userId"?(c(),_("span",se,f(u.user[0].nickname),1)):w.key==="previewPath"?(c(),_(Z,{key:1},[B((c(),T(i,{style:{"margin-right":"5px"},size:"small"},{default:l(()=>[p("复制")]),_:2},1024)),[[N,u.previewPath]]),u.srcType.startsWith("image/")&&u.previewPath?(c(),T(O,{key:0,width:"60px",src:u.previewPath},null,8,["src"])):P("",!0),u.previewPath?P("",!0):(c(),_("a",{key:1,href:u.previewPath,target:"_blank"},f(u.previewPath),9,ne)),u.srcType.startsWith("video/")&&u.previewPath?(c(),_("a",{key:2,target:"_blank",href:u.previewPath},"查看",8,ie)):P("",!0)],64)):w.key==="downloadPath"?(c(),_(Z,{key:2},[B((c(),T(i,{style:{"margin-right":"5px"},size:"small"},{default:l(()=>[p("复制")]),_:2},1024)),[[N,u.downloadPath]]),u.downloadPath?(c(),_("a",{key:0,target:"_blank",href:u.downloadPath},"下载",8,ue)):P("",!0)],64)):w.key==="action"?(c(),T(H,{key:3,viewAuth:"sys:resources:list",editAuth:"sys:resources:update",deleteAuth:"sys:resources:delete",onView:$=>A(u),onEdit:$=>C(u),onDelete:$=>S(u)},null,8,["onView","onEdit","onDelete"])):P("",!0)]),_:1},8,["loading","row-key","pagination","row-class-name","data-source"]),e(R,{minWidth:650,show:a.show.edit,title:a.editTitle,key:"GetResourcesInfo",onClose:n},{default:l(()=>[e(le,{updateData:a.updateData,onClose:n},null,8,["updateData"])]),_:1},8,["show","title"]),e(R,{minWidth:650,show:a.show.view,title:"查看资源管理",key:"ViewResourcesInfo",onClose:n},{default:l(()=>[e(re,{viewData:a.viewData,onClose:n},null,8,["viewData"])]),_:1},8,["show"])])}}};export{_e as default};
